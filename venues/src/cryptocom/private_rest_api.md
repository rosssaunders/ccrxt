# Crypto.com Exchange Private REST API

This document provides an overview of the Crypto.com Exchange private REST API endpoints implemented in this library.

## Overview

The Crypto.com Exchange private REST API provides access to authenticated user data and trading functionality including:

- Account information and balances
- Order management (create, cancel, amend)
- Trade history and order history
- Position management
- Transfers and withdrawals
- Staking operations

## Base URL

The private REST API base URL is:
```
https://deriv-api.crypto.com
```

## Authentication

All private endpoints require authentication using API keys and signatures. The authentication process involves:

1. **API Key**: Your unique API key identifier
2. **API Secret**: Used to sign requests with HMAC SHA256
3. **Nonce**: A unique incrementing number for each request
4. **Signature**: HMAC SHA256 signature of the request

### Request Signing

Each request must include:
- `method`: The API method name
- `id`: Unique request ID
- `api_key`: Your API key
- `nonce`: Unique incrementing number
- `sig`: HMAC SHA256 signature

The signature is generated by concatenating method + id + api_key + params + nonce and signing with your API secret.

## Rate Limits

Private endpoints have specific rate limits:
- General private endpoints: 1 request per second
- Order-related endpoints: 3 requests per second
- Balance/account endpoints: 1 request per second

## Available Endpoints

### Account Management

#### Get Account Information
- **Endpoint**: `private/get-accounts`
- **Rate Limit**: 1 req/s
- **Description**: Get account information including balances and margin details

#### Get Account Settings
- **Endpoint**: `private/get-account-settings`
- **Rate Limit**: 1 req/s
- **Description**: Get current account settings and configurations

#### Change Account Settings
- **Endpoint**: `private/change-account-settings`
- **Rate Limit**: 1 req/s
- **Description**: Update account settings including leverage and margin preferences

#### Change Account Leverage
- **Endpoint**: `private/change-account-leverage`
- **Rate Limit**: 1 req/s
- **Description**: Modify leverage settings for derivatives trading

### Order Management

#### Create Order
- **Endpoint**: `private/create-order`
- **Rate Limit**: 3 req/s
- **Description**: Place a new order (LIMIT, MARKET, STOP_LOSS, etc.)

#### Cancel Order
- **Endpoint**: `private/cancel-order`
- **Rate Limit**: 3 req/s
- **Description**: Cancel an existing order by order ID

#### Cancel All Orders
- **Endpoint**: `private/cancel-all-orders`
- **Rate Limit**: 3 req/s
- **Description**: Cancel all open orders for a specific instrument or all instruments

#### Amend Order
- **Endpoint**: `private/amend-order`
- **Rate Limit**: 3 req/s
- **Description**: Modify an existing order's price or quantity

#### Get Open Orders
- **Endpoint**: `private/get-open-orders`
- **Rate Limit**: 1 req/s
- **Description**: Retrieve all currently open orders

#### Get Order Detail
- **Endpoint**: `private/get-order-detail`
- **Rate Limit**: 1 req/s
- **Description**: Get detailed information about a specific order

### Order History and Trades

#### Get Order History
- **Endpoint**: `private/get-order-history`
- **Rate Limit**: 1 req/s
- **Description**: Get historical order data with optional filtering
- **Parameters**:
  - `instrument_name` (optional): Filter by specific instrument
  - `start_time` (optional): Start time in Unix timestamp (inclusive)
  - `end_time` (optional): End time in Unix timestamp (exclusive)
  - `limit` (optional): Maximum number of records (default: 100, max: 100)

**Important**: The maximum allowed time window for order history requests is **7 days**. When using `start_time` and `end_time` parameters, ensure the time difference does not exceed 604,800,000 milliseconds (7 days). This limitation ensures optimal performance and consistent API response times.

#### Get Order History by Instrument
- **Endpoint**: `private/get-order-history-by-instrument`
- **Rate Limit**: 1 req/s
- **Description**: Get order history filtered by specific instrument
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

#### Get Order History by Currency
- **Endpoint**: `private/get-order-history-by-currency`
- **Rate Limit**: 1 req/s
- **Description**: Get order history filtered by specific currency
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

#### Get Trades
- **Endpoint**: `private/get-trades`
- **Rate Limit**: 1 req/s
- **Description**: Get executed trades for recovery purposes
- **Parameters**:
  - `instrument_name` (optional): Filter by specific instrument
  - `start_time` (optional): Start time in Unix timestamp (inclusive)
  - `end_time` (optional): End time in Unix timestamp (exclusive)
  - `limit` (optional): Maximum number of records (default: 100, max: 100)

**Important**: The maximum allowed time window for trade history requests is **7 days**. This applies to all historical trade queries to maintain consistent API performance and compliance with exchange policies.

### Position Management

#### Get Positions
- **Endpoint**: `private/get-positions`
- **Rate Limit**: 1 req/s
- **Description**: Get current open positions

#### Close Position
- **Endpoint**: `private/close-position`
- **Rate Limit**: 3 req/s
- **Description**: Close an existing position

### Balance and Transaction History

#### Get User Balance
- **Endpoint**: `private/user-balance`
- **Rate Limit**: 1 req/s
- **Description**: Get current account balance

#### Get User Balance History
- **Endpoint**: `private/user-balance-history`
- **Rate Limit**: 1 req/s
- **Description**: Get historical balance information
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

#### Get Transactions
- **Endpoint**: `private/get-transactions`
- **Rate Limit**: 1 req/s
- **Description**: Get transaction history
- **Time Window Limitation**: Maximum 7 days for historical queries

### Transfers and Withdrawals

#### Create Withdrawal
- **Endpoint**: `private/create-withdrawal`
- **Rate Limit**: 1 req/s
- **Description**: Create a withdrawal request

#### Get Withdrawal History
- **Endpoint**: `private/get-withdrawal-history`
- **Rate Limit**: 1 req/s
- **Description**: Get withdrawal history
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

#### Get Deposit History
- **Endpoint**: `private/get-deposit-history`
- **Rate Limit**: 1 req/s
- **Description**: Get deposit history
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

#### Get Deposit Address
- **Endpoint**: `private/get-deposit-address`
- **Rate Limit**: 1 req/s
- **Description**: Get deposit address for a specific currency

### Staking Operations

#### Stake
- **Endpoint**: `private/stake`
- **Rate Limit**: 1 req/s
- **Description**: Create a new staking position

#### Unstake
- **Endpoint**: `private/unstake`
- **Rate Limit**: 1 req/s
- **Description**: Remove funds from staking

#### Get Staking Position
- **Endpoint**: `private/get-staking-position`
- **Rate Limit**: 1 req/s
- **Description**: Get current staking positions

#### Get Stake History
- **Endpoint**: `private/get-stake-history`
- **Rate Limit**: 1 req/s
- **Description**: Get staking transaction history
- **Time Window Limitation**: Maximum 7 days between start_time and end_time

## Time Window Limitations

**Important API Change**: As of the latest update, all endpoints that support time-based queries (`start_time` and `end_time` parameters) now have a maximum allowed time window of **7 days**. This applies to:

- Order history endpoints
- Trade history endpoints
- Balance history endpoints
- Transaction history endpoints
- Deposit/withdrawal history endpoints
- Staking history endpoints

### Implementation Guidelines

When implementing time-based queries:

1. **Parameter Validation**: Ensure `end_time - start_time â‰¤ 604,800,000` milliseconds (7 days)
2. **Error Handling**: Handle time window validation errors appropriately
3. **Pagination**: For data spanning more than 7 days, implement pagination by making multiple requests
4. **Default Behavior**: If no time range is specified, the API defaults to the last 24 hours

### Example Implementation

```rust
// Correct: Time window within 7 days
let request = GetTradesRequest {
    instrument_name: Some("BTCUSD-PERP".to_string()),
    start_time: Some("1640995200000".to_string()), // Start time
    end_time: Some("1641081600000".to_string()),   // End time (24 hours later)
    limit: Some(100),
};

// Incorrect: Time window exceeds 7 days - will result in error
let invalid_request = GetTradesRequest {
    instrument_name: Some("BTCUSD-PERP".to_string()),
    start_time: Some("1640995200000".to_string()),   // Start time
    end_time: Some("1641945600000".to_string()),     // End time (11 days later)
    limit: Some(100),
};
```

## Error Handling

Private endpoints return standardized error responses with:
- Error code
- Error message
- Method name
- Request ID

Common error codes:
- `10001`: Invalid parameter
- `10002`: Required parameter missing
- `10003`: Invalid instrument name
- `10004`: Request timeout
- `10005`: Rate limit exceeded
- `10006`: Insufficient balance
- `10007`: Invalid order status
- `10008`: Time window exceeds maximum allowed (7 days)

## Parameter Usage and Consistency

To ensure consistent API request behavior:

1. **Time Parameters**: Always use Unix timestamp in milliseconds
2. **String Precision**: Quantity and price values are strings to maintain precision
3. **Optional Parameters**: Use `Option<T>` types and skip serialization if None
4. **Instrument Names**: Use exact instrument name format (e.g., "BTCUSD-PERP")
5. **Limit Parameters**: Respect maximum limits per endpoint
6. **Nonce Values**: Ensure nonce values are strictly increasing

## Best Practices

1. **Rate Limiting**: Implement proper rate limiting in your client code
2. **Error Handling**: Always handle API errors gracefully
3. **Time Windows**: Respect the 7-day maximum time window for historical data
4. **Pagination**: Use pagination for large datasets
5. **WebSocket Usage**: Use WebSocket feeds for real-time data instead of polling REST endpoints
6. **Authentication**: Securely store and manage API credentials